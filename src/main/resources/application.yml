# Felles variabler
NAIS_APP_NAME: gjenlevende-bs-sak
DEPLOY_ENV: dev

# Server konfigurasjon
server:
    port: 8080

# Spring konfigurasjon
spring:
    application:
        name: gjenlevende-bs-sak

    security:
        oauth2:
            resourceserver:
                jwt:
                    issuer-uri: ${AZURE_OPENID_CONFIG_ISSUER}
                    audiences: ${AZURE_APP_CLIENT_ID}

    # Flyway database migrering
    flyway:
        enabled: true
        locations: classpath:db/migration
        placeholders:
            ignoreIfProd:

    # Database konfigurasjon
    datasource:
        url: ${DB_JDBC_URL}
        hikari:
            maximum-pool-size: 20
            connection-test-query: "select 1"
            max-lifetime: 90000
            minimum-idle: 1

# Management og health endepunkter
management:
    endpoint:
        health:
            show-details: always
            probes:
                enabled: true
    endpoints:
        web:
            exposure:
                include: health,prometheus
            base-path: /internal

# Azure AD konfigurasjon
azure:
    app:
        tenant:
            id: ${AZURE_APP_TENANT_ID}
        client:
            id: ${AZURE_APP_CLIENT_ID}
            secret: ${AZURE_APP_CLIENT_SECRET}



# OAuth2 klient konfigurering
familie-integrasjoner:
    url: ${FAMILIE_INTEGRASJONER_URL}
    oauth:
        registration-id: familie-integrasjoner-clientcredentials
pdl:
    url: ${PDL_URL}
    oauth:
        registration-id: pdl-clientcredentials
saf:
    url: ${SAF_URL}
    oauth:
        registration-id: saf-clientcredentials

oauth2:
    clients:
        pdl:
            registration-id: pdl-clientcredentials
            client-id: ${AZURE_APP_CLIENT_ID}
            client-secret: ${AZURE_APP_CLIENT_SECRET}
            token-endpoint-url: ${AZUREAD_TOKEN_ENDPOINT_URL}
            scope: ${PDL_SCOPE}
        familie-integrasjoner:
            registration-id: familie-integrasjoner-clientcredentials
            client-id: ${AZURE_APP_CLIENT_ID}
            client-secret: ${AZURE_APP_CLIENT_SECRET}
            token-endpoint-url: ${AZUREAD_TOKEN_ENDPOINT_URL}
            scope: ${FAMILIE_INTEGRASJONER_SCOPE}
        saf:
            registration-id: saf-clientcredentials
            client-id: ${AZURE_APP_CLIENT_ID}
            client-secret: ${AZURE_APP_CLIENT_SECRET}
            token-endpoint-url: ${AZUREAD_TOKEN_ENDPOINT_URL}
            scope: ${SAF_SCOPE}

# Azure AD miljøvariabler (for SwaggerConfig.kt)
AZUREAD_TOKEN_ENDPOINT_URL: https://login.microsoftonline.com/${azure.app.tenant.id}/oauth2/v2.0/token
AUTHORIZATION_URL: https://login.microsoftonline.com/${azure.app.tenant.id}/oauth2/v2.0/authorize
API_SCOPE: api://${azure.app.client.id}/.default

# Ekstern tjeneste konfigurasjon
gjenlevende-bs-infotrygd:
    url: https://gjenlevende-bs-infotrygd.dev-fss-pub.nais.io
    audience: api://dev-fss.etterlatte.gjenlevende-bs-infotrygd/.default

# FAMILIE DOKUMENT
FAMILIE_DOKUMENT_URL: http://familie-dokument

# Familie-integrasjoner
FAMILIE_INTEGRASJONER_URL: https://familie-integrasjoner.${DEPLOY_ENV}-fss-pub.nais.io
FAMILIE_INTEGRASJONER_SCOPE: api://${DEPLOY_ENV}-fss.teamfamilie.familie-integrasjoner/.default

# PDL (Persondataløsningen)
PDL_URL: https://pdl-api.dev-fss-pub.nais.io
PDL_SCOPE: api://dev-fss.pdl.pdl-api/.default

#SAF
SAF_URL: https://saf-q2.dev-fss-pub.nais.io
SAF_SCOPE: api://dev-fss.teamdokumenthandtering.saf/.default

# Swagger/OpenAPI konfigurasjon
springdoc:
    api-docs:
        path: /v3/api-docs
    swagger-ui:
        path: /swagger-ui.html
        operations-sorter: method
        tags-sorter: alpha
        try-it-out-enabled: true
        disable-swagger-default-url: true
        persist-authorization: true
        oauth:
            use-pkce-with-authorization-code-grant: true
            client-id: ${azure.app.client.id}
            scope-separator: ","

# Task prosessering konfigurasjon
prosessering:
    rolle: 928636f4-fd0d-4149-978e-a6fb68bb19de # 0000-GA-STDAPPS
    continuousRunning:
        enabled: true
    fixedDelayString:
        in:
            milliseconds: 15000
    delete:
        after:
            weeks: 16
